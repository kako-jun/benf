# POISSON_FEATURES.md - ポアソン分布機能仕様

## 概要
ポアソン分布（Poisson Distribution）の分析機能仕様。一定時間・空間内で発生するイベント数をモデル化する離散確率分布の包括的分析ツール。コールセンター、故障件数、自然災害、ウェブアクセス等の頻度分析に活用。

## 核心機能

### 1. ポアソン分布分析 (`lawkit poisson`)
**目的**: データがポアソン分布に従うかを検証し、イベント発生パターンの分析・予測を提供

**入力形式**:
- 非負整数データ（イベント発生回数）
- ファイル形式: CSV, JSON, Excel, テキスト
- 標準入力対応
- 国際数字対応（日本語数字、中国語金融数字等）

**出力メトリクス**:
- **分布パラメータ**: λ（発生率）・標本平均・標本分散・分散/平均比
- **適合度検定**: カイ二乗検定、Kolmogorov-Smirnov検定、分散比検定
- **品質評価**: 適合度スコア・ポアソン品質・分布評価
- **イベント確率**: P(X=0), P(X=1), P(X≥2)等の発生確率

### 2. ポアソン適合度検定機能
**3つの主要検定手法**:
- **カイ二乗適合度検定**: 観測度数と期待度数の比較、最も標準的
- **Kolmogorov-Smirnov検定**: 累積分布関数の比較、大標本対応
- **分散/平均比検定**: ポアソン分布の基本特性（分散=平均）の検証

**検定モード**:
```bash
lawkit poisson --test chi-square  # カイ二乗適合度検定のみ
lawkit poisson --test ks          # Kolmogorov-Smirnov検定のみ  
lawkit poisson --test variance    # 分散/平均比検定のみ
lawkit poisson --test all         # 全検定の統合結果
```

### 3. イベント確率予測機能
**確率計算・予測**:
- **個別確率**: P(X = k) = (λ^k × e^(-λ)) / k! の計算
- **累積確率**: 指定イベント数以下の発生確率
- **最頻値**: 最も発生しやすいイベント数の特定
- **裾確率**: 極端に多いイベント発生の確率

**確率予測モード**:
```bash
lawkit poisson --predict                    # 基本確率予測（0-10イベント）
lawkit poisson --predict --max-events 20   # 最大20イベントまで予測
```

### 4. 稀少事象分析機能
**稀少事象検出**:
- **閾値設定**: 95%・99%・99.9%分位点での稀少事象定義
- **極端事象**: 非常に稀な大規模イベントの特定
- **クラスタリング**: 稀少事象の連続発生パターン検出
- **リスク評価**: 異常パターンの統計的評価

**稀少事象分析モード**:
```bash
lawkit poisson --rare-events               # 稀少事象分析実行
```

### 5. 多言語対応
- **日本語**: ポアソン分布解析、イベント発生分析、稀少事象検出
- **英語**: Poisson Distribution Analysis, Event Frequency Analysis
- **中国語**: 泊松分布分析、事件频率分析
- **ヒンディー語**: पोइसन वितरण विश्लेषण
- **アラビア語**: تحليل توزيع بواسون

## CLI仕様

### 基本コマンド
```bash
lawkit poisson [入力データ] [オプション]
```

### 主要オプション
- `--format FORMAT`: 出力形式 (text, json, csv, yaml, toml, xml)
- `--quiet/-q`: 最小出力（パラメータのみ）
- `--verbose/-v`: 詳細分析・解釈付き
- `--lang/-l LANGUAGE`: 出力言語 (en, ja, zh, hi, ar, auto)
- `--filter RANGE`: 数値範囲フィルタ
- `--min-count NUMBER`: 最小データ点数（デフォルト10）

### 専用モードオプション
- `--test TYPE`: ポアソン検定モード (chi-square, ks, variance, all)
- `--predict`: イベント確率予測モード
- `--max-events NUMBER`: 予測最大イベント数 (デフォルト10)
- `--rare-events`: 稀少事象分析モード

### 使用例

#### 基本分析
```bash
# 基本ポアソン分布分析
echo "0 1 2 1 0 3 1 2 0 1" | lawkit poisson

# 詳細分析（日本語）
lawkit poisson call_center_data.csv --verbose --lang ja

# CSVファイルの分析
lawkit poisson failure_counts.csv --format json
```

#### ポアソン適合度検定
```bash
# カイ二乗適合度検定
lawkit poisson data.csv --test chi-square

# 全検定の実行
echo "0 1 0 2 1 0 1 3 0 1" | lawkit poisson --test all --lang en

# 分散/平均比検定のJSON出力
lawkit poisson sample.txt --test variance --format json
```

#### イベント確率予測
```bash
# 基本確率予測（0-10イベント）
lawkit poisson historical_data.csv --predict

# 最大20イベントまで予測
echo "1 2 1 0 3 1 2 0 1" | lawkit poisson --predict --max-events 20

# 確率予測のJOSN出力
lawkit poisson data.txt --predict --format json --verbose
```

#### 稀少事象分析
```bash
# 稀少事象分析
lawkit poisson disaster_counts.csv --rare-events

# 稀少事象のJOSN出力
echo "0 1 0 2 1 0 8 1 0 1 0 12" | lawkit poisson --rare-events --format json

# 稀少事象の詳細分析
lawkit poisson extreme_events.csv --rare-events --verbose --lang ja
```

## 出力形式

### テキスト出力（デフォルト）
```
ポアソン分布解析結果

データセット: call_center_data.csv
解析した数値数: 100
品質レベル: Low

ポアソンパラメータ:
  λ (発生率パラメータ): 2.35
  標本平均: 2.35
  標本分散: 2.41
  分散/平均比: 1.026

適合度検定:
  Chi-Square: χ²=3.24, p=0.356
  Kolmogorov-Smirnov: D=0.067, p=0.234
  分散/平均比: 1.026, p=0.412

適合度評価:
  適合度スコア: 0.842
  ポアソン品質: 0.891
  分布評価: Excellent

イベント発生確率:
  P(X = 0) = 0.095
  P(X = 1) = 0.224
  P(X ≥ 2) = 0.681

解釈:
✅ 優れたポアソン分布適合
   データはポアソン分布に良く従っています
```

### JSON出力
```json
{
  "dataset": "call_center_data.csv",
  "numbers_analyzed": 100,
  "risk_level": "Low",
  "lambda": 2.35,
  "sample_mean": 2.35,
  "sample_variance": 2.41,
  "variance_ratio": 1.026,
  "chi_square_test": {
    "statistic": 3.24,
    "p_value": 0.356
  },
  "kolmogorov_smirnov_test": {
    "statistic": 0.067,
    "p_value": 0.234
  },
  "goodness_of_fit_score": 0.842,
  "poisson_quality": 0.891,
  "distribution_assessment": "Excellent",
  "event_probabilities": {
    "zero": 0.095,
    "one": 0.224,
    "two_or_more": 0.681
  },
  "rare_events": {
    "threshold": 7,
    "count": 2
  },
  "confidence_interval_lambda": [2.12, 2.58]
}
```

### CSV出力
```csv
dataset,numbers_analyzed,risk_level,lambda,sample_mean,sample_variance,variance_ratio,goodness_of_fit_score
call_center_data.csv,100,Low,2.350,2.350,2.410,1.026,0.842
```

## 品質評価基準

### Quality Level（品質レベル）
- **Low (優秀)**: 適合度スコア > 0.8、分散/平均比 ≈ 1、極端な外れ値なし
- **Medium (良好)**: 適合度スコア > 0.6、軽微な分散逸脱、稀少事象少数
- **High (要注意)**: 適合度スコア > 0.3、有意な分散逸脱、稀少事象多数  
- **Critical (問題)**: 適合度スコア ≤ 0.3、非ポアソン的、極端な逸脱

### ポアソン分布判定基準
- **分散/平均比**: 1.0に近いほどポアソン的（0.8-1.2が理想的）
- **適合度検定**: p値 > 0.05 でポアソン分布に適合
- **分散状態**: 比 > 1.5（過分散）、比 < 0.7（過少分散）で要注意

### 分布評価段階
- **Excellent**: 優秀なポアソン適合、実用的なモデル化可能
- **Good**: 良好な適合、軽微な逸脱あり
- **Moderate**: 中程度の適合、一部でポアソン性逸脱
- **Poor**: 不十分な適合、改善必要
- **NonPoisson**: ポアソン分布でない、別モデル検討要

## 応用分野

### コールセンター・顧客サービス
- **着信数分析**: 時間帯別・曜日別の電話着信パターン
- **待ち時間予測**: キュー理論による顧客待ち時間最適化
- **スタッフ配置**: 需要予測による人員計画
- **サービス品質**: 応答時間・解決率の統計的管理

### 故障・保守管理
- **機器故障**: 設備・システムの故障発生頻度分析
- **メンテナンス**: 予防保守スケジュールの最適化
- **部品交換**: スペア部品の需要予測・在庫管理
- **システム可用性**: 障害頻度による可用性評価

### 自然災害・リスク管理
- **地震発生**: 地域別・期間別の地震発生頻度
- **気象災害**: 台風・洪水等の自然災害パターン
- **事故分析**: 交通事故・産業事故の発生頻度
- **保険数理**: 保険請求・損害発生の統計モデル

### ウェブ・IT分野
- **アクセス解析**: サイトアクセス・ページビューの分析
- **エラー監視**: システムエラー・障害の発生パターン
- **セキュリティ**: 攻撃・侵入試行の検出・分析
- **ネットワーク**: パケット到着・トラフィック解析

### 生物学・医学
- **感染症**: 感染者数・発症パターンの疫学分析
- **細胞計数**: 顕微鏡下での細胞・微生物カウント
- **遺伝子変異**: 突然変異・遺伝的事象の頻度
- **薬効評価**: 副作用・有害事象の発生率

## 技術的制約

### データ要件
- **データ型**: 非負整数のみ（0, 1, 2, 3, ...）
- **最小データ点数**: 10個（統計的検出力確保）
- **推奨サイズ**: 30-1000データ点（最適な検定精度）
- **上限**: 実用上制限なし（大規模データ対応）

### 適用条件・前提
- **独立性**: 各イベントが独立して発生
- **定常性**: 発生率λが時間的に一定
- **稀少性**: イベント発生確率が小さい
- **離散性**: カウント可能な離散事象

### 性能特性
- **処理速度**: O(n log n) - ソート・頻度計算が支配的
- **メモリ使用量**: O(n) - データサイズに比例、頻度表作成
- **精度**: 浮動小数点64bit、階乗計算の数値安定性

### 制限事項
- 負の値・小数値は受け付けない
- 極端に大きなλ値（>100）では近似誤差発生可能
- 非常に小さなサンプル（n < 10）では検定力不足
- 強い過分散データではポアソン近似不適切

## アルゴリズム詳細

### ポアソン確率計算
```
P(X = k) = (λ^k × e^(-λ)) / k!

数値安定性のため対数計算:
ln P(X = k) = k×ln(λ) - λ - ln(k!)
```

### λパラメータ推定
```
最尤推定法:
λ̂ = x̄ = (1/n) × Σ(xi)

信頼区間（大標本近似）:
λ̂ ± 1.96 × √(λ̂/n)
```

### 適合度検定アルゴリズム
```
カイ二乗検定:
χ² = Σ((Oi - Ei)² / Ei)
where Oi: 観測度数, Ei: 期待度数

Kolmogorov-Smirnov検定:
D = max|F̂n(x) - F0(x)|
where F̂n: 経験分布, F0: 理論ポアソン分布
```

### 稀少事象閾値
```
95%分位点: P(X ≤ q0.95) = 0.95
99%分位点: P(X ≤ q0.99) = 0.99
99.9%分位点: P(X ≤ q0.999) = 0.999

逆引き計算で閾値決定
```

## 統合機能

### 他法則との比較
- **正規分布**: 連続 vs 離散、大λでの正規近似
- **ベンフォード法則**: 自然性 vs イベント頻度
- **パレート法則**: 集中 vs 分散パターン
- **Zipf法則**: べき乗 vs 指数的減衰

### 出力連携
- 全形式で統一されたスキーマ
- 統計ソフトウェア（R/Python/SAS）連携
- BI・可視化ツール対応
- 時系列分析ツール統合

### 将来拡張
- 複合ポアソン過程（重複イベント）
- 空間ポアソン過程（2次元・3次元）
- 時間依存ポアソン過程（非定常λ）
- ベイズポアソン回帰
- リアルタイム監視・アラート機能