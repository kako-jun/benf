# ベンフォードの法則チェックアプリ

Rustで作るCLIアプリケーション。数値データがベンフォードの法則に従っているかをチェックする。

## 機能要件
- パイプからの文字列入力に対応
- 引数で与えた文字列に対応  
- URLを指定してWebサイトのデータを解析
- ファイル入力（多様なフォーマット対応）
- HTMLタグを除外して数値のみを抽出する独自機能

## 技術仕様
- 言語: Rust
- 入力方式: 
  - stdin (パイプ)
  - コマンドライン引数（文字列データ）
  - ファイルパス引数（Excel/PDF/Word等）
  - URL引数（HTTP/HTTPS）
  - **優先順位**: URL > ファイル > 文字列 > パイプ (複数指定時)
- HTML解析: 独自実装またはクレート使用
- 数値抽出: 正規表現ベース
- 出力形式: 
  - デフォルト: 人間可読テキスト + ASCII グラフ (標準出力)
  - --format オプション: csv, json, yaml, toml, xml (標準出力)
  - --quiet: 数値結果のみ
  - --verbose: 詳細統計情報付き
  - ファイル保存: リダイレクト使用 (例: benf data.csv --format json > result.json)

## 競合分析と独自性
- 既存のベンフォード法則CLIツールは英語圏作成
- **独自性**：日本語数字への対応
  - 全角数字（０１２３４５６７８９）
  - 漢数字（一二三四五六七八九十百千万）
  - 混在パターンの処理
- 既存ツールの機能を同等以上に実装
- 競合の予定機能も先行実装
- GUI版機能のCUI擬似再現

## 開発メモ
- 独自にURL引数でHTTP取得する方式が良い理由：
  - HTMLタグを除外して数値のみ抽出可能
  - パイプ経由よりも使いやすい
  - エラーハンドリングが統一できる
- 数値の先頭桁の分布を計算してベンフォードの法則と比較
- ベンフォードの法則の理論値：
  - 1が先頭: 30.1%
  - 2が先頭: 17.6%
  - 3が先頭: 12.5%
  - ...9が先頭: 4.6%
- 統計的な適合度テスト（カイ二乗検定など）
- 一致度指標の実装（既存ツール互換）
- 使用予定クレート: 
  - reqwest (HTTP通信)
  - scraper (HTML解析)
  - calamine (Excel読み込み)
  - pdf-extract (PDF解析)
  - docx-rs (Word解析)
- 日本語数字変換ロジック実装必要
- **重要**: 数値サンプル数が少ない場合の警告表示
- **重要**: 負数・小数の扱い方針を明確化
- **重要**: エラーハンドリング - ファイル読み込み失敗、ネットワーク障害
- **重要**: パフォーマンス - 大容量ファイル処理時のメモリ管理
- **重要**: セキュリティ - 悪意あるURL/ファイルの処理制限
- **重要**: コマンドライン引数設計 - 文字列 vs ファイルパス vs URL の自動判別ロジック
- **重要**: 終了コード設計 - 成功/警告/エラー/異常検知の区別
- **重要**: ヘルプ・バージョン表示 (--help, --version, -h, -V)
  - バージョン情報にビルド日時・commit hash含める
  - 作者名はREADME/ライセンスのみ、CLI出力には含めない
- **重要**: ログレベル設定 (--log-level debug/info/warn/error)
- **致命的**: ゼロで始まる数値の扱い (001, 0.5等) - ベンフォード法則対象外
- **致命的**: 設定ファイルの場所とフォーマット決定 ※シンプル化のため削除検討
- **致命的**: 国際化対応 (i18n) - エラーメッセージの多言語化
- **致命的**: テストデータセット同梱の是非
- **致命的**: ドキュメント・マニュアル生成方法
  - README.md (英語): インストール・基本使用法・サンプル
  - README_ja.md (日本語): 日本語数字対応の詳細説明
  - man page: 詳細オプション説明  
  - CHANGELOG.md: バージョン履歴
  - **先行作成**: 実装前にREADMEで仕様確定・API設計検証
- **致命的**: クロスプラットフォーム対応 (Windows/macOS/Linux)
- **致命的**: 依存関係のバージョン管理とセキュリティ更新ポリシー
- **致命的**: 引数なし実行時の動作 - 自動ヘルプ表示 vs エラー vs stdin待機
- **致命的**: 進捗表示とキャンセル処理 (Ctrl+C対応)
- **致命的**: 一時ファイル管理とクリーンアップ処理
- **致命的**: メモリ使用量制限とOOM対策
- **致命的**: 文字エンコーディング対応 (UTF-8/Shift_JIS/EUC-JP)
- **致命的**: 数値精度とオーバーフロー処理
- **致命的**: 設定の優先順位 (CLI引数 > デフォルト) ※シンプル化
- **致命的**: プロキシ対応 - HTTP_PROXY/HTTPS_PROXY環境変数 + --proxy オプション
- **致命的**: SSL/TLS証明書検証 - OSの証明書ストア利用 vs 独自CA証明書対応
- **致命的**: 自己署名証明書 - --insecure オプションで検証スキップ可能にするか
- **致命的**: ログ出力設計 - OSデフォルトログ場所 vs ログなし vs syslog連携
  - Linux: /var/log/ または ~/.local/state/
  - macOS: ~/Library/Logs/
  - Windows: %APPDATA%/Logs/
  - **重要**: ログは標準出力に出さない（パイプ処理妨害防止）
- **超致命的**: タイムアウト設定 - URL/大容量ファイル処理の無限待機防止
- **超致命的**: リトライ制御 - ネットワーク一時障害対応
- **超致命的**: 同時接続数制限 - 複数URL処理時のサーバー負荷対策
- **超致命的**: User-Agent設定 - サーバーからのブロック回避
- **超致命的**: レート制限対応 - API制限やDDoS防止対策
- **超致命的**: リダイレクト処理 - HTTP 301/302の追跡制限
- **超致命的**: Content-Type検証 - HTMLでないコンテンツの処理方針
- **超致命的**: バイナリファイル判定 - 処理対象外ファイルのスキップ

## 機能提案
### 既存ツール標準機能
- 棒グラフ・ヒストグラム出力（ASCII art）
- CSV/JSON/YAML/TOML形式での結果出力
- 複数ファイル・URL一括処理
- 信頼区間表示
- p値計算
- 詳細統計情報（平均絶対偏差など）

### 不正検知特化機能
- **異常検知**: 法則から大きく逸脱した時点でアラート
  - 危険度レベル表示 (LOW/MEDIUM/HIGH/CRITICAL)
  - 警告・エラーは標準エラー出力 (stderr) に出力
  - 危険度は結果データに含める
  - 閾値カスタマイズ可能
- **ライブモニタリング**: `tail -f` のようにリアルタイムでデータ監視
- **比較モード**: 複数データセットの法則適合度比較
- **フィルタリング**: 特定範囲の数値のみ解析（例：100以上）
- **不正検知対象フォーマット**:
  - Excel (.xlsx, .xls) - 会計データ、売上レポート
  - PDF - 財務諸表、監査報告書、申告書
  - HTML - Webレポート、オンライン申請
  - Word (.docx, .doc) - 報告書、稟議書
  - PowerPoint (.pptx, .ppt) - プレゼン資料の数値
  - OpenDocument (.ods, .odt) - オープンオフィス文書
  - 画像 (OCR) - スキャンした帳票、領収書 ※将来機能
  - CSV/TSV - データエクスポート
  - JSON/XML - API レスポンス、システムログ
  - YAML/TOML - 設定ファイル、データ定義
- **並列処理**: マルチスレッドでの高速解析

## パイプライン活用例
### 監視・自動化
- `benf --url API_ENDPOINT --format json | jq '.p_value < 0.05'`
- `tail -f access.log | benf --format json | jq 'select(.risk_level == "HIGH")'`
- `crontab: benf sales.csv --format json | mail -s "Daily Fraud Check"`

### データ処理チェーン
- `benf data.csv --format json | jq '.digits[0]' | gnuplot`
- `benf --quiet | awk '{if($1<0.5) print "suspicious"}' | tee report.txt`
- `find . -name "*.csv" -exec benf {} \; | sort -k2 -n`

### 統計分析パイプライン
- `benf data | R --slave -e "summary(scan())"`
- `benf --format csv | python analysis.py | benf` (二次解析)
- `benf | fzf --preview "echo 'Score: {}'"` (インタラクティブ選択)

## 実用的メリット・応用例
### 不正検知・監査
- **会計監査**: 売上データ・経費データの人為的操作検出
- **税務調査**: 申告書数値の不自然な偏りを発見
- **選挙監視**: 投票数・得票率の改ざん疑惑検証
- **保険査定**: 保険金請求額の詐欺パターン検出

### データ品質管理
- **システム障害検知**: ログデータの異常パターン発見
- **センサー故障**: IoTデバイスの測定値異常検出
- **APIレスポンス**: 外部サービスのデータ品質監視
- **データベース整合性**: バックアップ・レプリケーション検証

### 研究・分析支援
- **科学データ検証**: 実験結果の信頼性評価
- **マーケット分析**: 株価・取引量の自然性確認
- **人口統計**: 国勢調査データの妥当性検証
- **ソーシャル分析**: SNS投稿数・いいね数の真正性判定

### リスク管理
- **金融リスク**: 取引パターンの異常検知
- **サイバーセキュリティ**: 攻撃トラフィックの識別
- **品質管理**: 製造データの工程異常発見