# ZIPF_FEATURES.md - Zipf法則機能仕様

## 概要
Zipf法則（ジップの法則）の分析機能仕様。言語学者ジョージ・キングズリー・ジップが発見した「単語の出現頻度は順位に反比例する（1/rank）」という現象を検証・分析する。べき乗法則の一種として、言語分析・ウェブ分析・都市人口分析等に応用される。

## 核心機能

### 1. Zipf分析 (`lawkit zipf`)
**目的**: データ分布がZipf法則（1/rank分布）に従うかを検証し、分布特性を分析

**分析モード**:
- **数値モード**: 頻度データの直接分析
- **テキストモード**: 文章から単語頻度を抽出・分析（`--text`フラグ）

**入力形式**:
- **数値データ**: 頻度値リスト（降順推奨）
- **テキストデータ**: 自然言語文章（多言語対応）
- ファイル形式: CSV, JSON, TXT, 各種ドキュメント
- 標準入力対応

**出力メトリクス**:
- **Zipf指数**: 理論値1.0に対する実測値
- **相関係数**: 理論Zipf分布との適合度
- **分布品質**: Zipf法則への適合度スコア
- **べき乗法則適合度**: KS統計量ベースの適合性
- **多様性指数**: Shannon entropy
- **集中度指数**: Gini係数

### 2. 多言語テキスト分析
**日本語対応**:
- ひらがな（\u{3040}-\u{309F}）
- カタカナ（\u{30A0}-\u{30FF}）
- 漢字（\u{4E00}-\u{9FAF}）
- 文字単位での分割・頻度集計

**その他言語**:
- **英語**: 単語単位分割
- **中国語**: 文字単位分割
- **ヒンディー語・アラビア語**: Unicode対応

**トークナイザー機能**:
- 区切り文字自動検出
- 大文字小文字正規化
- 最小単語長フィルタ（2文字以上）

### 3. 分布分析機能
**理論分布比較**:
- 理想Zipf分布（1/rank）生成
- ピアソン相関係数計算
- 対数線形回帰による指数推定

**統計的適合性**:
- Kolmogorov-Smirnov検定（簡易版）
- 分布品質スコア（0-1）
- べき乗法則フィット評価

## CLI仕様

### 基本コマンド
```bash
lawkit zipf [入力データ] [オプション]
```

### 主要オプション
- `--text`: テキスト分析モード（単語頻度分析）
- `--format FORMAT`: 出力形式 (text, json, csv, yaml, toml, xml)
- `--quiet/-q`: 最小出力（メトリクスのみ）
- `--verbose/-v`: 詳細分析・解釈付き
- `--lang/-l LANGUAGE`: 出力言語 (en, ja, zh, hi, ar, auto)
- `--filter RANGE`: 数値範囲フィルタ
- `--min-count NUMBER`: 最小データ点数（デフォルト5）

### 使用例

#### 数値データ分析
```bash
# 理想的なZipf分布の検証
echo "1000 500 333 250 200 166 142 125 111 100" | lawkit zipf --verbose

# ウェブサイトページビュー分析
lawkit zipf pageviews.csv --format json

# 売上ランキング分析
lawkit zipf sales_ranking.txt --lang ja --verbose
```

#### テキスト分析
```bash
# 英語文章の単語頻度分析
echo "the quick brown fox jumps over the lazy dog" | lawkit zipf --text --lang en

# 日本語文章分析
lawkit zipf document.txt --text --lang ja --verbose

# 多言語文書分析
cat multilingual.txt | lawkit zipf --text --verbose
```

#### フィルタリング・詳細分析
```bash
# 高頻度語のみ分析
lawkit zipf corpus.txt --text --filter ">=10" --verbose

# 最小出力
lawkit zipf data.csv --quiet --format csv
```

## 出力形式

### テキスト出力（デフォルト）
```
ジップの法則解析結果

データセット: corpus.txt
解析した数値数: 50
注意レベル: Low

ジップ指標:
  ジップ指数: 0.987
  相関係数: 0.956
  分布品質: 0.943
  べき乗法則適合度: 0.871

分布統計:
  総観測数: 10000
  ユニーク項目数: 50
  最頻項目出現率: 12.5%
  集中度指数: 0.456
  多様性指数（シャノン）: 3.124

解釈:
✅ 理想的なジップ分布 - ジップの法則に従っています
   分布は期待される1/rankパターンに従っています
   📊 ジップの法則への優れた適合
```

### JSON出力
```json
{
  "dataset": "corpus.txt",
  "numbers_analyzed": 50,
  "risk_level": "Low",
  "zipf_exponent": 0.987,
  "correlation_coefficient": 0.956,
  "distribution_quality": 0.943,
  "total_observations": 10000,
  "unique_items": 50,
  "top_item_frequency": 12.5,
  "concentration_index": 0.456,
  "diversity_index": 3.124,
  "power_law_fit": 0.871,
  "rank_frequency_pairs": [
    [1, 1250.0],
    [2, 625.0],
    [3, 416.7],
    [4, 312.5]
  ]
}
```

### CSV出力
```csv
dataset,numbers_analyzed,risk_level,zipf_exponent,correlation_coefficient,distribution_quality,power_law_fit
corpus.txt,50,Low,0.987,0.956,0.943,0.871
```

## リスク評価基準

### Low (理想的Zipf分布)
- Zipf指数: 0.8-1.2（理論値1.0に近い）
- 相関係数: > 0.8
- 分布品質: > 0.8
- **解釈**: 典型的なZipf分布、自然な頻度分布

### Medium (軽微な偏差)
- Zipf指数: 0.6-1.4
- 相関係数: > 0.6
- 分布品質: > 0.6
- **解釈**: わずかな偏差、監視推奨

### High (有意な偏差)
- Zipf指数: 0.4-1.7
- 相関係数: > 0.4
- **解釈**: 明確な偏差、分布の再検討推奨

### Critical (重大な偏差)
- 上記基準外
- **解釈**: Zipf法則に従わない分布、戦略見直し必要

## 応用分野

### 言語学・文章分析
- **コーパス分析**: 文章の語彙多様性評価
- **翻訳品質**: 自然さの客観評価
- **執筆スタイル**: 著者特性の分析
- **言語学習**: 重要語彙の特定

### ウェブ・デジタル分析
- **ページビュー分析**: 人気コンテンツの集中度
- **検索クエリ**: キーワード分布の分析
- **SNS分析**: 投稿・シェア頻度分布
- **アプリ使用分析**: 機能利用頻度

### ビジネス・マーケティング
- **商品売上分析**: ロングテール vs 集中戦略
- **顧客アクセス**: 利用パターン分析
- **在庫管理**: 需要予測の精度向上
- **価格戦略**: 頻度ベース価格設定

### 学術・研究分野
- **論文引用分析**: 影響力分布の評価
- **都市人口分析**: 都市規模分布（Zipf-Mandelbrot）
- **生態学**: 種の個体数分布
- **経済学**: 企業規模・所得分布

## 技術的制約

### データ要件
- **最小データ点数**: 5個（設定可能）
- **推奨データサイズ**: 20-10000データ点
- **データ型**: 正の数値のみ（頻度データ）

### テキスト分析制約
- **最小単語長**: 2文字以上
- **メモリ制限**: 大規模テキストは分割処理推奨
- **文字エンコーディング**: UTF-8のみサポート

### 性能特性
- **数値分析**: O(n log n) - ソート処理
- **テキスト分析**: O(m) - 文字数m
- **メモリ使用量**: O(n + v) - データ数n + 語彙数v

### 制限事項
- ゼロ頻度は除外
- 極端に大きな頻度値（1e15超）は精度低下
- 非ASCII文字の一部でトークナイズ精度低下の可能性

## アルゴリズム詳細

### Zipf指数計算
```
log(frequency) = -α * log(rank) + constant
α = Zipf指数（理論値1.0）
```

### 相関係数計算
```
理論分布: f_theoretical(rank) = 1/rank
観測分布: f_observed(rank)
相関係数 = pearson(f_theoretical, f_observed)
```

### 分布品質スコア
```
指数品質 = 1 - |α - 1.0|（最大偏差1.0で制限）
相関品質 = |相関係数|
品質スコア = 0.6 * 指数品質 + 0.4 * 相関品質
```

## 統合機能

### 他法則との比較
- **ベンフォード法則**: 初桁分布 vs 頻度分布
- **パレート法則**: 価値集中 vs 頻度集中
- **組み合わせ分析**: 複数視点からのデータ評価

### 出力連携
- 全形式で統一されたスキーマ
- 他統計ツールとの連携
- 可視化ツール用データ出力

### 将来拡張
- グラフィカル出力（ローレンツ曲線）
- リアルタイム分析
- 機械学習との統合